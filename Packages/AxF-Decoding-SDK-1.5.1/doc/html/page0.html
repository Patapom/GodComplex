<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AxF Decoding SDK: Integration Guidelines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="AxF-SDK-Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AxF Decoding SDK
   &#160;<span id="projectnumber">1.5</span>
   </div>
   <div id="projectbrief">Decoding AxF representations</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">AxF Decoding SDK</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Integration Guidelines </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#guidelines_sec01">Integrating AxF into Rendering Applications</a><ul><li class="level2"><a href="#guidelines_sec01_ssec01">Analyzing File Contents</a></li>
<li class="level2"><a href="#guidelines_sec01_ssec02">Decoding AxF Representations</a></li>
<li class="level2"><a href="#guidelines_sec01_ssec03">Handling Colors and Spectra</a><ul><li class="level3"><a href="#guidelines_sec01_ssec03_sssec01">Spectral Rendering</a></li>
</ul>
</li>
<li class="level2"><a href="#guidelines_sec01_ssec04">Handling Strings and Textual Metadata</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="guidelines_sec01"></a>
Integrating AxF into Rendering Applications</h1>
<p><br />
 </p>
<h2><a class="anchor" id="guidelines_sec01_ssec01"></a>
Analyzing File Contents</h2>
<p>It is strongly recommended to have a look at the example application that is part of the SDK distribution. It demonstrates the basic usage of the AxF Decoding SDK beginning with opening the file and analyzing its contents, which consists of the following main steps:</p><ol type="1">
<li>Retrieve a valid AxF file handle using <a class="el" href="namespaceaxf_1_1decoding.html#a2f15e132eb528e19b35a08766ffe1ad5" title="Open an AxF File and return handle. ">axf::decoding::axfOpenFile()</a>.</li>
<li>Select a material (by index) using <a class="el" href="namespaceaxf_1_1decoding.html#ab47c81aea5fa5deffeed2dc7e3f40bad" title="Get a handle to a specific material stored in the AxF file. ">axf::decoding::axfGetMaterial()</a>.</li>
<li>Retrieve a valid representation handle \(H\) for the selected material, e.g. using <a class="el" href="namespaceaxf_1_1decoding.html#a36755ec273d115909eefb03268beec0c" title="Return a handle to the preferred supported representation of an AxF material. ">axf::decoding::axfGetPreferredRepresentation()</a>.</li>
<li>Determine the type of the representation as follows:<ol type="a">
<li>Retrieve the main appearance class (SVBRDF, CarPaint, or FactorizedBTF) using <a class="el" href="namespaceaxf_1_1decoding.html#a57cd171d9aa6a6c53e0ddceb8dd06898" title="Retrieve the RepresentationClass, which classifies the representation as SVBRDF, CarPaint, etc. ">axf::decoding::axfGetRepresentationClass</a>( \(H\)).</li>
<li>In case of an SVBRDF, retrieve the handles \(H_d\) and \(H_s\) for the diffuse and specular sub-components of the representation, using <a class="el" href="namespaceaxf_1_1decoding.html#a5dbc9210d9c3801de81fb22d4cd9ed43" title="Given an AxF representation (of representation class SVBRDF, CarPaint, or CarPaint2), retrieve the child representation for the diffuse component of the BRDF model. ">axf::decoding::axfGetSvbrdfDiffuseModelRepresentation</a>( \(H\)) and <a class="el" href="namespaceaxf_1_1decoding.html#a736a18d854555b7a29eb38dade7f538c" title="Given an AxF representation (of representation class SVBRDF, CarPaint, or CarPaint2), retrieve the child representation for the specular component of the BRDF model. ">axf::decoding::axfGetSvbrdfSpecularModelRepresentation</a>( \(H\)), respectively, from which the following additional information can be queried:<ol type="i">
<li>the particular diffuse BRDF model (so far always Lambert) using <a class="el" href="namespaceaxf_1_1decoding.html#a544463086d0f705d06909be912f51ce2" title="Retrieve the TypeKey from the given representation node. ">axf::decoding::axfGetRepresentationTypeKey</a>( \(H_d\));</li>
<li>the particular specular BRDF model (Ward, Cook-Torrance, ...) using <a class="el" href="namespaceaxf_1_1decoding.html#a544463086d0f705d06909be912f51ce2" title="Retrieve the TypeKey from the given representation node. ">axf::decoding::axfGetRepresentationTypeKey</a>( \(H_s\));</li>
<li>the precise variant of the specular BRDF model using <a class="el" href="namespaceaxf_1_1decoding.html#a9260fc8b8fba5f1cc449f9557ed4e199" title="Retrieve a string and a few flags identifying the variant of the specular model represented in the Ax...">axf::decoding::axfGetSvbrdfSpecularModelVariant</a>( \(H_s\)) and <a class="el" href="namespaceaxf_1_1decoding.html#a25dc1b612b112141e79a835e93b56697" title="Retrieve a string identifying the variant of the used Fresnel approximation. ">axf::decoding::axfGetSvbrdfSpecularFresnelVariant</a>( \(H_s\)).</li>
</ol>
</li>
</ol>
</li>
<li>Decide if the found representation is supported by the client application, either by analyzing the previously determined representation type or via the helper function <a class="el" href="namespaceaxf_1_1decoding.html#ac3229499828c83f0c934e1c865a452d3" title="Check if representation fits into the given compatibility profile. ">axf::decoding::axfCheckRepresentationCompatibilityProfile()</a>, which can be exploited if the client application supports one of the predefined compatibility profiles.</li>
<li>If the found representation type is not supported by the client application and the material contains more than a single representation, alternative representations can be selected, going back to step 3.</li>
<li>Finally use <a class="el" href="namespaceaxf_1_1decoding.html#a7bfca744e73963e6097b27bca542a045" title="Get the display name of a given material. ">axf::decoding::axfGetMaterialDisplayName()</a> to get the material name as Unicode string (see Section <a class="el" href="page0.html#guidelines_sec01_ssec04">Handling Strings and Textual Metadata</a> for details).</li>
</ol>
<h2><a class="anchor" id="guidelines_sec01_ssec02"></a>
Decoding AxF Representations</h2>
<p>After selecting a supported representation it comes to the decoding (i.e. rendering), which can be done in two ways: either by using the SDK's built-in CPU-based decoding functionality or by retrieving the appearance model parameters from the AxF file and implementing and evaluating the model in the client application.</p>
<p>Details regarding the usage of the built-in decoding functionality can be found at <a class="el" href="classaxf_1_1decoding_1_1_c_p_u_decoder.html" title="Decodes AxF representations on the CPU. ">axf::decoding::CPUDecoder</a>.</p>
<p>Please note that the SDK implementations for CPU-based decoding are not aggressively optimized, but rather should be considered as reference implementations of the particular representations and should be used primarily for reference and testing purposes. In particular, we do not recommend to use this way of decoding in performance critical production environments. Instead, we encourage client applications to implement the representations internally and use the <a class="el" href="classaxf_1_1decoding_1_1_texture_decoder.html" title="Decodes texture resources from AxF representations. ">axf::decoding::TextureDecoder</a> interface for retrieval of the appearance model parameters (i.e. textures). The technical details including pseudo-code, required for implementing a particular representation can be found at</p><ul>
<li><a class="el" href="page1.html">SVBRDF Representation</a></li>
<li><a class="el" href="page2.html">Hybrid Model- and Image-based Carpaint Representation</a></li>
<li><a class="el" href="page3.html">Representations based on Matrix Factorization</a></li>
</ul>
<h2><a class="anchor" id="guidelines_sec01_ssec03"></a>
Handling Colors and Spectra</h2>
<p>AxF supports storing color resources in monochromatic, trichromatic, pseudo-spectral and full spectral color spaces. To facilitate that, each color resource is associated with a certain ColorSpec node, which specifies the corresponding color space precisely.</p>
<p>In any case, AxF uses a linear color space (i.e. a linear subspace of the spectral space) to store a color resource. Please note that we consider a color (from a color resource) to correspond to a reflectance spectrum (i.e. spectral reflectance in physical terms) or to a projection thereof into the respective linear subspace that the ColorSpec represents. A unity reflectance spectrum represents a neutral material, i.e. one for which the spectrum of the reflected light corresponds exactly to the spectrum of the incoming light.</p>
<p>Currently, the information from the ColorSpec node cannot be retrieved explicitly via the SDK. Instead the client application defines a target color space into which all retrieved color resources will be converted (based on the AxF-internal ColorSpec node) before returning them to the client. Currently, only trichromatic, linear color spaces for the 2&deg; standard observer (CIE 1931) can be used as target color space. Supported target color spaces include the CIE 1931 XYZ color space as well as several linear RGB color spaces with different primaries (corresponding to the primaries of the well-known non-linear RGB color spaces sRGB, Adobe RGB, Adobe Wide-Gamut RGB, and ProPhoto RGB). All of them map the unity reflectance spectrum (that represents a neutral material) to a unity color value \((1\; 1\; 1)\), which is a requirement for using the resulting color values in trichromatic lighting computations. (Note that performing lighting in a trichromatic color space, as further discussed in the following, is not colorimetrically precise, but often applied in context of rendering for performance reasons. From a colorimetric point of view, it is more advisable to perform the lighting in spectral space; for this see Section <a class="el" href="page0.html#guidelines_sec01_ssec03_sssec01">Spectral Rendering</a> below.)</p>
<p>To generate any kind of rendering, first a lighting computation (i.e. a multiplication with a respective light color) has to be performed, before the texture is converted to the respective display color space. This also applies to displaying preview images from the AxF file, since we consider them to be evaluated SVBRDFs (for a certain geometry and lighting condition), i.e. a texture of linear reflectance values, which is premultiplied with \(\left&lt;N,L\right&gt;\), but not yet multiplied with the light color (and not yet mapped to a non-linear display color space).</p>
<p>Let us illustrate the required color transformation that is to be performed by the client application with one example: Let us assume that the standard sRGB profile (IEC 61966-2-1) should be used as display color space and that lighting should be computed in the linear target color space with sRGB primaries, which is called AXF_COLORSPACE_LINEAR_SRGB_E in the SDK. (And let us further assume that the transformation to the sRGB display profile should be computed directly, rather than via the chain of transformations imposed by an ICC profile.) In that case, the transformation to the sRGB profile, which is to be applied after the lighting, basically only consists of a mapping of the white point, followed by a non-linear mapping (also known as gamma curve) as defined by the sRGB standard. (In addition, it might be advisable to apply chromatic adaptation and gamut mapping techniques at this point as well, but we leave this out here for brevity.) The white point mapping is required since while AXF_COLORSPACE_LINEAR_SRGB_E has the same primaries as the sRGB profile, it does not have the same white point: While the white point of the sRGB profile corresponds by specification to the chromaticity of CIE illuminant D65, the white point of our target color space AXF_COLORSPACE_LINEAR_SRGB_E corresponds &ndash; as motivated above &ndash; to the unity reflectance spectrum (which again corresponds to CIE illuminant E, thus the name AXF_COLORSPACE_LINEAR_SRGB_E). So in order to map the resulting color &ndash; after having applied the lighting &ndash; from AXF_COLORSPACE_LINEAR_SRGB_E into the sRGB profile, at first the white point of our color space has to be mapped to the white point of the sRGB profile (CIE illuminant D65). This simply corresponds to a normalization of the RGB color for the D65 white point to \((1\; 1\; 1)\). Afterwards, the non-linear mapping (gamma curve) has to be applied. Note that if you apply lighting (in AXF_COLORSPACE_LINEAR_SRGB_E) with precisely the same illuminant (D65), the multiplication with the light color and the white point mapping as described above are exactly inverse to each other, such that these two steps cancel out and might potentially be omitted in this very special case.</p>
<h3><a class="anchor" id="guidelines_sec01_ssec03_sssec01"></a>
Spectral Rendering</h3>
<p>It is planned to add functions to the SDK to query color resources in spectral space as well, but right now this is not yet supported. Nonetheless, besides selecting a trichromatic target color space and querying color resources in this target color space, the SDK also allows to query a "spectralization transformation" (see <a class="el" href="namespaceaxf_1_1decoding.html#a09fd2908f12def53a464dcf61f17cef8" title="Get a material-dependent linear transformation from a (linear) source color space to the spectral spa...">axf::decoding::axfGetSpectralizationTrafo()</a>), which is a matrix that can be used to transform a trichromatic color from the selected target color space to a corresponding spectrum (for any given spectral sampling). Obviously, this cannot always guarantee a precise reconstruction of the original spectra. Nonetheless, the SDK tries to determine a transformation that is optimized for reconstructing the primary material spectra as good as possible, provided that respective spectral information is available in the AxF file. So this transformation might improve significantly upon a standard RGB-to-spectral conversion that doesn't take such additional spectral information into account.</p>
<h2><a class="anchor" id="guidelines_sec01_ssec04"></a>
Handling Strings and Textual Metadata</h2>
<p>AxF differentiates two types of strings:</p><ol type="1">
<li>strings used for denoting AxF objects like material nodes</li>
<li>strings used for encoding content i.e. text documents and metadata</li>
</ol>
<p>Strings of the first type in general consist of plain ASCII 8-bit characters (datatype <em>char</em>). In the SDK these strings appear e.g. as material ID strings (cf. <a class="el" href="namespaceaxf_1_1decoding.html#ae15b05d7447db96c2de30a625cf5f41f" title="Get the ID string of a given material. ">axf::decoding::axfGetMaterialIDString()</a>) or as metadata document names (e.g. <a class="el" href="namespaceaxf_1_1decoding.html#aaaf594ce212173a09924895ae7900037" title="Get the name of a metadata document stored in the AxF file. ">axf::decoding::axfGetMetadataDocumentName()</a>). These strings should usually not be displayed in the GUI but solely used for accessing and indexing AxF objects. <br />
 Starting from version 1.4 the AxF SDK uses Unicode to store textual payload. In the SDK this textual payload is queried using wide character strings (datatype <em>wchar_t</em>) whose encoding is compiler dependent. While the Windows version uses UTF-16, Linux and Mac versions use UCS-4/UTF-32. See also <a class="el" href="namespaceaxf_1_1decoding.html#a7bfca744e73963e6097b27bca542a045" title="Get the display name of a given material. ">axf::decoding::axfGetMaterialDisplayName()</a> and <a class="el" href="namespaceaxf_1_1decoding.html#ab7a5898420f230e93f06d02c3aa2350b" title="Enum of property data types used in the metadata retrieval interface and TextureDecoder&#39;s property in...">axf::decoding::PropertyType</a>. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 18 2018 00:04:38 for AxF Decoding SDK by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
